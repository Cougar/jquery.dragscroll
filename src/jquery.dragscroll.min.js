/*
 *\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
 *\\\\\\\\\\\\\/\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
 *\\\\\\\\\\\\\/\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\/\/\/\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
 *\\\\\\\/\/\\/\\\/\/\/\\\\/\/\/\\\\\/\/\/\\\\\/\\\\\\/\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
 *\\\\\/\\\\\/\\\/\\\\\\\/\\\\\/\\\/\\\\\/\\\\\\/\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\/\\\/\\\\\\\\
 *\\\\\\/\/\/\\\/\\\\\\\\\/\/\/\\\\\/\/\/\\\\\\\\/\\\\\/\/\/\\\/\/\/\\\\/\/\/\\\\/\\\/\\\\\\\\\
 *\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\/\\\\/\\\\\/\\\/\\\\\\\/\\\\\\/\\\\\\/\\\/\\\/\\\\\\\\\\
 *\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\/\\/\\\\\\/\/\/\\\\/\/\/\\\/\\\\\\\/\/\/\\\\\/\\\/\\\\\\\\\\\
 *\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
 *
 * jquery.dragscroll.js
 * a scrolling plugin for the jQuery JavaScript Library
 *
 * Copyright 2011, Thomas Appel, http://thomas-appel.com, mail(at)thomas-appel.com
 * dual licensed under MIT and GPL license
 * http://dev.thomas-appel.com/licenses/mit.txt
 * http://dev.thomas-appel.com/licenses/gpl.txt
 *
 * 
 *
 * changelog:
 * --------------------------------------------------------------------------------------------
 * - 0.2.b3pre:
 * --------------------------------------------------------------------------------------------
 *		- fixed MSIE 6+ issues
 * --------------------------------------------------------------------------------------------
 * - 0.2.b2pre:
 * --------------------------------------------------------------------------------------------
 *		- removed some options: onScrollInit, workOnChildElement, onScrollDirChange
 *		- fixed some problemes
 *		- changed some internal functions
 *		- general refactoring issues
 * -------------------------------------------------------------------------------------------- 
 * - 0.2.b1pre:
 * --------------------------------------------------------------------------------------------
 *		- completely rewrote this plugin
 *		- added scrollbars
 *		- added mousewheel support
 * --------------------------------------------------------------------------------------------
 * - 0.1.b5b	fixed classname removal on plugin destruction
 * - 0.1.b5a	rewrote almost the whole scrolling mechanism
 * - 0.1.b4:	rewrote event unbinding (teardown,destroy), plugin is now self destroyable
 * - 0.1.b3:	fixed event unbinding (teardown)
 * - 0.1.b2:	fixed touch event support
 * - 0.1.b1:	plugin teardown method added
 * --------------------------------------------------------------------------------------------
 *
 * usage:
 * --------------------------------------------------------------------------------------------
 * - $('selector').dragscroll();
 * - if jquery.event.destroyed.js is available or if you use javascriptMVC,
 *   the plugin will detroy itself automatically
 *
 * - to destroy plugin manually call  $('selector').data('dragscroll').destroy();
 *
 * - see index.html in example directory for a more complex sample setup
 * - visit http://dev.thomas-appel.com/dragscroll for a live demo
 *
 *
 * Features to come:
 * --------------------------------------------------------------------------------------------
 * - pageup pagedown key support
 * known issues:
 * --------------------------------------------------------------------------------------------
 * - MSIE 8 doesn't fade out scrollbar handles
 * --------------------------------------------------------------------------------------------
 * @author Thomas Appel 
 * @version 0.2.b3pre
 */
 (function(d,b){var e=b.document,f=d(b),g=d.browser.msie&&d.browser.version<9?d("html"):f;function c(k,h,j){var i=k[0]["scroll"+j]/h["outer"+j]();return[i,Math.floor(h["inner"+j]()/i)]}function a(){this.init.apply(this,arguments)}a.prototype={name:"dragscroll",isTouchDevice:b.ontouchstart!==void 0};d.extend(a.prototype,{events:{M_DOWN:a.prototype.isTouchDevice?"touchstart."+a.prototype.name:"mousedown."+a.prototype.name,M_UP:a.prototype.isTouchDevice?"touchend."+a.prototype.name:"mouseup."+a.prototype.name,M_MOVE:a.prototype.isTouchDevice?"touchmove."+a.prototype.name:"mousemove."+a.prototype.name,M_ENTER:"mouseenter."+a.prototype.name,M_LEAVE:"mouseleave."+a.prototype.name,M_WHEEL:"mousewheel."+a.prototype.name,S_STOP:"scrollstop."+a.prototype.name,S_START:"scrollstart."+a.prototype.name,SCROLL:"scroll."+a.prototype.name,RESIZE:a.prototype.isTouchDevice?"orientationchange."+a.prototype.name:"resize."+a.prototype.name},init:function(k,i){var l="<div/>",j=this;this.options=i;this.elem=k;this.innerElem=this.elem.wrapInner(l).children(0);this.scrollElem=this.innerElem.wrap(l).parent();this.elem.addClass(this.name+"-container");this.innerElem.addClass(this.name+"-inner");this.scrollElem.addClass(this.name+"-scroller");var h=d(l);this.scrollBarContainer=d([h,h.clone()]);this.scrollBar=d([h.clone(),h.clone()]);this.scrollBarContainer.each(function(n){var p=n===0?"h":"v",m=j.options.autoFadeBars?" autohide":"";j.scrollBarContainer[n].addClass(j.name+"-scrollbar-container "+p+m).append(j.scrollBar[n].addClass(j.name+"-scrollbar "+p));j._addBars(n)});this.elem.css("overflow","visible");this.mx=0;this.my=0;this.__tmp__={_diff_x:0,_diff_y:0,_temp_x:0,_temp_y:0,_x:0,_y:0,_mx:0,_my:0,_deltaX:0,_deltaY:0,_start:{x:0,y:0}};this.__tmp__._scrolls=false;this._buildIndex();this.timer=void 0;this._bind();this.elem.trigger(this.name+"ready")},reInit:function(){return this._buildIndex()},_addBars:function(h){if(this.options.scrollBars){this.scrollBarContainer[h].appendTo(this.elem)}},_buildIndex:function(){this.barIndex={X:c(this.scrollElem,this.scrollElem,"Width"),Y:c(this.scrollElem,this.scrollElem,"Height")};this._getContainerOffset();this.scrollBar[0].css({width:this.barIndex.X[1]});this.scrollBar[1].css({height:this.barIndex.Y[1]});this.__tmp__._cdd={x:this.options.scrollBars?this.scrollBarContainer[0].innerWidth():this.scrollElem.innerWidth(),y:this.options.scrollBars?this.scrollBarContainer[1].innerHeight():this.scrollElem.innerHeight()};this.barIndex.X[0]===1?this.scrollBarContainer[0].detach():this._addBars(0);this.barIndex.Y[0]===1?this.scrollBarContainer[1].detach():this._addBars(1)},_bind:function(){var h=this;g.bind(this.events.RESIZE,d.proxy(this._buildIndex,this));this.elem.bind("destroyed",d.proxy(this.teardown,this));this.elem.bind(this.name+"ready",d.proxy(this.onInitReady,this));this.elem.delegate("."+this.name+"-scrollbar-container",this.events.M_DOWN,d.proxy(this.scrollStart,this));this.elem.bind(this.events.M_WHEEL,d.proxy(this.scrollStart,this));this.scrollElem.bind(this.events.M_DOWN,d.proxy(this.dragScrollStart,this));if(this.options.autoFadeBars){this.elem.delegate("."+this.name+"-scrollbar-container","mouseenter",d.proxy(this.showBars,this)).delegate("."+this.name+"-scrollbar-container","mouseleave",d.proxy(this.hideBars,this))}this.elem.bind(this.events.S_START,function(){h.options.onScrollStart.call(h.elem.addClass("scrolls"));h.options.autoFadeBars&&h.showBars()}).bind(this.events.S_STOP,function(){h.options.onScrollEnd.call(h.elem.removeClass("scrolls"));h.options.autoFadeBars&&h.hideBars()})},_unbind:function(){this.elem.unbind(this.name+"ready").undelegate("."+this.name+"-scrollbar-container",this.events.M_DOWN).undelegate("."+this.name+"-scrollbar-container","mouseenter").undelegate("."+this.name+"-scrollbar-container","mouseleave").unbind(this.events.M_WHEEL).unbind(this.events.S_STOP).unbind(this.events.S_START);this.scrollElem.unbind(this.events.M_DOWN);g.unbind(this.events.M_MOVE).unbind(this.events.M_UP).unbind(this.events.RESIZE)},onInitReady:function(){if(this.options.autoFadeBars){this.showBars().hideBars()}else{this.showBars()}},initMouseWheel:function(h){switch(h){case"rebind":this.elem.unbind(this.events.M_WHEEL).bind(this.events.M_WHEEL,d.proxy(this.scrollStart,this));break;default:this.elem.unbind(this.events.M_WHEEL).bind(this.events.M_WHEEL,d.proxy(this._getMousePosition,this));break}},_getContainerOffset:function(){this.containerOffset=this.elem.offset()},_pageXY:(function(){if(a.prototype.isTouchDevice){return function(h){return{X:h.originalEvent.touches[0].pageX,Y:h.originalEvent.touches[0].pageY}}}else{return function(h){return{X:h.pageX,Y:h.pageY}}}}()),_getScrollOffset:function(){return{x:this.scrollElem[0].scrollLeft,y:this.scrollElem[0].scrollTop}},_getMousePosition:function(k,l,i,h){k.preventDefault();if(!l){var j=this._pageXY.apply(this,arguments);this.mx=this.__tmp__._scrollsX?Math.max(0,Math.min(this.__tmp__._cdd.x,j.X-this.containerOffset.left)):this.mx;this.my=this.__tmp__._scrollsY?Math.max(0,Math.min(this.__tmp__._cdd.y,j.Y-this.containerOffset.top)):this.my}else{i=i!==undefined?-i:l;h=h!==undefined?h:l;i=Math.min(5,Math.max(i,-5));h=Math.min(5,Math.max(h,-5));this.__tmp__._deltaX=i;this.__tmp__._deltaY=h;if(i===0&&h===0){this.scrollStop()}}},_getWheelDelta:function(){var h=this.scrollElem.innerHeight(),i=this.scrollElem.innerWidth();this.mx-=this.mx<=i?this.__tmp__._deltaX*(this.options.mouseWheelVelocity):0;this.my-=this.my<=h?this.__tmp__._deltaY*(this.options.mouseWheelVelocity):0;this.mx=Math.min(Math.max(0,this.mx),i);this.my=Math.min(Math.max(0,this.my),h);this.__tmp__._deltaX=null;this.__tmp__._deltaY=null},_getDragScrollPosition:function(){var i,h,j=this.options.smoothness;this.__tmp__._diff_x=this.__tmp__._diff_x>0?this.__tmp__._diff_x++-(this.__tmp__._diff_x++/j):this.__tmp__._diff_x---(this.__tmp__._diff_x--/j);this.__tmp__._diff_y=this.__tmp__._diff_y>0?this.__tmp__._diff_y++-(this.__tmp__._diff_y++/j):this.__tmp__._diff_y---(this.__tmp__._diff_y--/j);i=Math.round(Math.max(Math.min(this.scrollElem[0].scrollLeft+this.__tmp__._diff_x,this.scrollElem[0].scrollWidth),0));h=Math.round(Math.max(Math.min(this.scrollElem[0].scrollTop+this.__tmp__._diff_y,this.scrollElem[0].scrollHeight),0));this.__tmp__._x=i;this.__tmp__._y=h;return[this.__tmp__._x,this.__tmp__._y]},_hasScrolledSince:function(){var h=this.scrollElem[0].scrollLeft,i=this.scrollElem[0].scrollTop;return{verify:this.__tmp__._temp_x!==h||this.__tmp__._temp_y!==i,scrollLeft:h,scrollTop:i}},_getScrollPosition:function(h,j){var k,i;k=h*this.barIndex.X[0];i=j*this.barIndex.Y[0];this.__tmp__._x+=(k-this.__tmp__._x)/this.options.smoothness;this.__tmp__._y+=(i-this.__tmp__._y)/this.options.smoothness;return[this.__tmp__._x,this.__tmp__._y]},_getDiff:function(){var i=this.scrollElem[0].scrollTop,h=this.scrollElem[0].scrollLeft;this.__tmp__._diff_x=h-this.__tmp__._temp_x;this.__tmp__._diff_y=i-this.__tmp__._temp_y;this.__tmp__._temp_x=h;this.__tmp__._temp_y=i},setScrollbar:function(){this.scrollBar[0].css({left:Math.abs(Math.ceil(this.scrollElem[0].scrollLeft/this.barIndex.X[0]))});this.scrollBar[1].css({top:Math.abs(Math.ceil(this.scrollElem[0].scrollTop/this.barIndex.Y[0]))})},scroll:function(i,k){var h=this.scrollElem[0].scrollLeft,j=this.scrollElem[0].scrollTop;i=this.__tmp__._scrollsX?Math.round(i):h;k=this.__tmp__._scrollsY?Math.round(k):j;this.scrollElem.scrollLeft(i).scrollTop(k)},scrollStart:function(m,n){this.stopScroll();var l=m.target,k=l===this.scrollBar[0][0],j=l===this.scrollBar[1][0],i=l===this.scrollBarContainer[0][0],h=l===this.scrollBarContainer[1][0];m.preventDefault();this.scrollElem.unbind(this.events.SCROLL);this.__tmp__._scrollsX=k||i;this.__tmp__._scrollsY=j||h;this._getMousePosition.apply(this,arguments);if(n){this.__tmp__._scrollsX=true;this.__tmp__._scrollsY=true;this.__tmp__._mode="wheel";this.__tmp__._start.x=0;this.__tmp__._start.y=0;this._checkDragMXYPos();this.initMouseWheel()}else{g.bind(this.events.M_MOVE,d.proxy(this._getMousePosition,this));g.bind(this.events.M_UP,d.proxy(this.scrollStop,this));this.__tmp__._start.x=k?this.mx-this.scrollBar[0].offset().left+this.scrollBarContainer[0].offset().left:i?Math.round(this.scrollBar[0].outerWidth()/2):0;this.__tmp__._start.y=j?this.my-this.scrollBar[1].offset().top+this.scrollBarContainer[1].offset().top:h?Math.round(this.scrollBar[1].outerHeight()/2):0;this.__tmp__._mode="scrollbar"}this.startTimer("scrollBPos");this.elem.trigger(this.events.S_START)},scrollBPos:function(){var i,h,j;this._getDiff();if(this.__tmp__._mode==="wheel"){this._getWheelDelta()}h=Math.min(Math.max(0,this.mx-this.__tmp__._start.x),this.__tmp__._cdd.x-this.barIndex.X[1]);i=Math.min(Math.max(0,this.my-this.__tmp__._start.y),this.__tmp__._cdd.y-this.barIndex.Y[1]);j=this._getScrollPosition(h,i);this.__tmp__._scrollsX&&this.scrollBar[0].css({left:h});this.__tmp__._scrollsY&&this.scrollBar[1].css({top:i});this.scroll(j[0],j[1]);this.startTimer("scrollBPos");if(this.__tmp__._mode==="wheel"&&this.__tmp__._scrolls&&!this._hasScrolledSince().verify){this.scrollStop()}if(!this.__tmp__._scrolls){this.__tmp__._scrolls=true}this.__tmp__.mx=this.mx;this.__tmp__.my=this.my},scrollStop:function(i){var h=this._hasScrolledSince();g.unbind(this.events.M_MOVE);g.unbind(this.events.M_UP);if(h.verify){this.startTimer("scrollStop")}else{this.stopScroll();this._clearScrollStatus(false);this.initMouseWheel("rebind");this.elem.trigger(this.events.S_STOP);this.__tmp__._mx=null;this.__tmp__._my=null;this.__tmp__._start.x=0;this.__tmp__._start.y=0}this.__tmp__._temp_x=h.scrollLeft;this.__tmp__._temp_y=h.scrollTop},dragScrollStart:function(h){this.stopScroll();h.preventDefault();this._clearScrollStatus(true);this._getMousePosition.apply(this,arguments);this.__tmp__._start.x=this.mx+this.scrollElem[0].scrollLeft;this.__tmp__._start.y=this.my+this.scrollElem[0].scrollTop;g.bind(this.events.M_MOVE,d.proxy(this._getMousePosition,this));g.bind(this.events.M_UP,d.proxy(this._initDragScrollStop,this));this.scrollElem.bind(this.events.SCROLL,d.proxy(this.setScrollbar,this));this.startTimer("dragScrollMove");this.elem.trigger(this.events.S_START)},_checkDragMXYPos:function(){var h=this._getScrollOffset();this.mx=Math.round((h.x)/this.barIndex.X[0]);this.my=Math.round((h.y)/this.barIndex.Y[0])},dragScrollMove:function(){this.stop=false;var h=Math.min(Math.max(this.__tmp__._start.x-this.mx,0),this.scrollElem[0].scrollWidth),j=Math.min(Math.max(this.__tmp__._start.y-this.my,0),this.scrollElem[0].scrollHeight),i=this._getScrollOffset();this._getDiff();this.scroll(h,j);this.__tmp__.temp_x=i.x;this.__tmp__.temp_y=i.y;this.startTimer("dragScrollMove")},_initDragScrollStop:function(){g.unbind(this.events.M_MOVE);g.unbind(this.events.M_UP);this.elem.removeClass("scrolls");this.stopScroll();this.dargScrollStop()},dargScrollStop:function(){var h=this._hasScrolledSince(),i;if(h.verify){i=this._getDragScrollPosition();this.scroll(i[0],i[1]);this.startTimer("dargScrollStop");this.__tmp__._temp_x=h.scrollLeft;this.__tmp__._temp_y=h.scrollTop}else{this.stopScroll();this.scrollElem.unbind(this.events.SCROLL);this._clearScrollStatus(false);this.elem.trigger(this.events.S_STOP)}},_clearScrollStatus:function(){var k=arguments,j=k.length,i=k[0],h=k[1],m=k[2];if(j===1){h=i;m=i}if(j===2){m=h}this.__tmp__._scrolls=i;this.__tmp__._scrollsX=h;this.__tmp__._scrollsY=m},hideBars:function(){if(this.__tmp__._scrolls){return this}this.scrollBarContainer.each(function(){this.stop().delay(100).fadeTo(250,0)});return this},showBars:function(){this.scrollBarContainer.each(function(){if(parseInt(this.css("opacity"))<1){this.css({opacity:0,display:"block"});this.stop().delay(100).fadeTo(250,1)}});return this},startTimer:function(h){var i=this;this.timer=b.setTimeout(function(){i[h]()},15)},stopScroll:function(){b.clearTimeout(this.timer);this.timer=void 0},teardown:function(j){var h=2;this.elem.removeClass("scrolls");this._unbind();this.elem.unbind("destroyed");while(h--){this.scrollBarContainer[h].empty().remove()}d.removeData(this.name)}});d.fn.dragscroll=function(h){var j={scrollClassName:"",scrollBars:true,smoothness:15,mouseWheelVelocity:2,autoFadeBars:true,onScrollStart:function(){},onScrollEnd:function(){}},k=d.extend({},j,h),i=this;return this.each(function(){d(this).data(a.prototype.name,new a(i,k))})}}(this.jQuery,this));
